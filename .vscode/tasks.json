{
"version": "2.0.0",
"tasks": [
{
"label": "genealogy: docker compose up",
"type": "shell",
"command": "docker",
"args": [
"compose",
"-f",
".\\api\\docker-compose.yml",
"up",
"-d",
"--build"
],
"isBackground": false,
"problemMatcher": [],
"group": "build"
},
{
"label": "genealogy: check docker/psql",
"type": "shell",
"command": "Get-Command docker, psql, pg_ctl -ErrorAction SilentlyContinue | Select-Object Name,Source | Format-Table -AutoSize",
"isBackground": false,
"problemMatcher": []
},
{
"label": "genealogy: run api (uvicorn 8080)",
"type": "shell",
"command": "$root='${workspaceFolder}'; $apiDir=Join-Path $root 'api'; $py=Join-Path $root '.venv\\Scripts\\python.exe'; if (-not (Test-Path $py)) { throw 'Missing venv python: ' + $py }; Set-Location $apiDir; $env:DATABASE_URL='postgresql://postgres:polini@localhost:5432/genealogy'; & $py -m uvicorn main:app --host 127.0.0.1 --port 8080",
"isBackground": true,
"problemMatcher": [],
"group": "build"
},
{
"label": "genealogy: restart api (detached 8080)",
"type": "shell",
"command": "$root='${workspaceFolder}'; $apiDir=Join-Path $root 'api'; $py=Join-Path $root '.venv\\Scripts\\python.exe'; if (-not (Test-Path $py)) { throw 'Missing venv python: ' + $py }; $env:DATABASE_URL='postgresql://postgres:polini@localhost:5432/genealogy'; $conn = Get-NetTCPConnection -LocalPort 8080 -ErrorAction SilentlyContinue | Select-Object -First 1; if ($conn -and $conn.OwningProcess -gt 0) { Stop-Process -Id $conn.OwningProcess -Force -ErrorAction SilentlyContinue }; $stamp = Get-Date -Format 'yyyyMMdd_HHmmss'; $reports = Join-Path $root 'reports'; if (-not (Test-Path $reports)) { New-Item -ItemType Directory -Path $reports | Out-Null }; $outLog = Join-Path $reports ('uvicorn_' + $stamp + '.out.log'); $errLog = Join-Path $reports ('uvicorn_' + $stamp + '.err.log'); Start-Process -FilePath $py -WorkingDirectory $apiDir -ArgumentList @('-m','uvicorn','main:app','--host','127.0.0.1','--port','8080') -RedirectStandardOutput $outLog -RedirectStandardError $errLog -WindowStyle Hidden; 'Restarted API. Logs: ' + $outLog + ' / ' + $errLog",
"isBackground": false,
"problemMatcher": [],
"group": "build"
}
]
}
